#!/usr/bin/env python
# coding: utf-8

# <div dir='rtl'>
# <h1>ูพุฑูฺู ุงูู ุนููู ุงุนุตุงุจ ูุญุงุณุจุงุช</h1>
# <br/>
#     - ุตูุฑุช ูพุฑูฺู ุฏุฑ 
#     <a href="https://cnrl.github.io/cns-project-template/Phase1.html">ุงู ุขุฏุฑุณ</a>
#     ูุงุจู ูุดุงูุฏู ุงุณุช.
# <br/>
#     - <font color='red'>ุจุง ุชูุฌู ุจู ุฏุดูุงุฑ ุญูุธ ุณุงุฎุชุงุฑ ุตูุฑุช ูพุฑูฺู ุฏุฑ ฺฏุฒุงุฑุดุ ุขู ุณุงุฎุชุงุฑ ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู
#     ูุทุงูุจ ุจุง ุณุงุฎุชุงุฑ ููุงุณุจ ุจุฑุง ุฏูุจุงู ฺฉุฑุฏู ูููุฏุงุฑโูุง ู ูุทุงูุจ ููุธู ุดุฏูโุงูุฏุ ุจุง ุงูุญุงู ุชูุงู ูุทุงูุจ ุฎูุงุณุชู ุดุฏู
#     ุฏุฑ ุตูุฑุช ูพุฑูฺูุ ุฏุฑ ุงู ฺฏุฒุงุฑุด ูพูุดุงูุฏู ุดุฏูโุงูุฏ.</font>
# </div>

# <div dir='rtl'>
# <h2>0. ููุฑุณุช ูุทุงูุจ</h2>
# <ol>
#     <li><a href="#1">ูุฏู LIF</a></li>
#     <li><a href="#2">ูุฑูุฏ ุฌุฑุงู ุชุตุงุฏู</a></li>
#     <ol>
#         <li><a href="#2A">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุฏุงูููโูุง ูุชูุงูุช ุฌุฑุงู ูุฑูุฏ</a></li>
#         <li><a href="#2B">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ููุงูุชโูุง ูุชูุงูุช</a></li>
#         <li><a href="#2C">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุซุงุจุช ุฒูุงู($\tau$)โูุง ูุชูุงูุช</a></li>
#         <li><a href="#2D">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ๐๐๐๐๐โ๐กโ๐๐๐โ๐๐๐ูุง ูุชูุงูุช</a></li>
#     </ol>
#     <li><a href="#3">ูุฑูุฏ ุฌุฑุงู ุซุงุจุช</a></li>
#     <ol>
#         <li><a href="#3A">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุฏุงูููโูุง ูุชูุงูุช ุฌุฑุงู ูุฑูุฏ</a></li>
#         <li><a href="#3B">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ููุงูุชโูุง ูุชูุงูุช</a></li>
#         <li><a href="#3C">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุซุงุจุช ุฒูุงู($\tau$)โูุง ูุชูุงูุช</a></li>
#         <li><a href="#3D">ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ๐๐๐๐๐โ๐กโ๐๐๐โ๐๐๐ูุง ูุชูุงูุช</a></li>
#     </ol>
#     <li><a href="#4">ูุฑูุฏ ุฌุฑุงูโูุง ุฏฺฏุฑ</a></li>
#     <ol>
#         <li><a href="#4A">ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ูุชูุงุฒู</a></li>
#         <li><a href="#4B">ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ูุชูุงุฒู ุจุง ุซุงุจุช ุฒูุงู ูุฏู ููุฑูู ุจุฒุฑฺฏ</a></li>
#         <li><a href="#4C">ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ุบุฑ ูุชูุงุฒู</a></li>
#     </ol>
#     <li><a href="#5">F-I Curve</a></li>
# </ol>
# </div>

# <a id='1'></a>
# <div dir='rtl'>
# <h2>1. ูุฏู LIF</h2>
# <br/>
#     ุจุฑุง ูพุงุฏูโุณุงุฒ ุงู ูุฏู ููุฑููุ ฺฉุงู ุงุณุช ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุฑุง ุฏุฑ ูุฑ ฺฏุงู ุทุจู ุฑุงุจุทู ุฒุฑ ุจู ุฑูุฒุฑุณุงู ฺฉูู:
# $$
# U(t+\Delta) = U(t) - \frac{\Delta}{\tau}[(U(t)-U_{rest}) - R.I(t)]
# $$
# $$
# if \;\; U(t) > U_{spike-threshold}: U(t) = 0 \;\;\; and \;\;\; spike-on!
# $$
#     ุจุง ุชูุฌู ุจู ุฑุงุจุทูโ ุจุงูุงุ ุงูุชุธุงุฑุงุช ุฒุฑ ุฑุง ุงุฒ ุฑูุชุงุฑ ุงู ูุฏู ููุฑูู ุฏุงุฑู ฺฉู ุฏุฑ ุงุฏุงูู ุตุญุช ุขูโูุง ุฑุง ุจุฑุฑุณ ูโฺฉูู:
#     <br/>
#     1- ุจุง ุงูุฒุงุด ูุฒุงู ุฌุฑุงู ูุฑูุฏุ ุงุฎุชูุงู ูพุชุงูุณู ูุซุจุชโุชุฑ ู ุฏุฑูุชุฌู ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุจุดุชุฑ ุดุงูุฏ ูุณุชู.
#     <br/>
#     2- ุจุง ุงูุฒุงุด ูุฒุงู ููุงูุช (R)ุ ูุฒุงู ุชุฃุซุฑูพุฐุฑ ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุงุฒ ุฌุฑุงู ูุฑูุฏ ุจุดุชุฑ ูโุดูุฏ.
#     ุจู ุฒุจุงู ุณุงุฏูโุชุฑุ ุจุง ุฏุฑุงูุช ุฌุฑุงู ูุฑูุฏุ ุงุฎุชูุงู ูพุชุงูุณู ุจุง ุณุฑุนุช ุจุดุชุฑ ุงูุฒุงุด ูพุฏุง ูโฺฉูุฏ (ูุซุจุช ูโุดูุฏ) ู
#     ุฏุฑูุชุฌู ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุงูุฒุงุด ูพุฏุง ูโฺฉูุฏ.
#     <br/>
#     3- ุจุง ุงูุฒุงุด $\tau$ุ ุจู ุตูุฑุช ฺฉู ุณุฑุนุช ุชุบุฑุงุช ุงุฎุชูุงู ูพุชุงูุณู ฺฉุงูุด ูพุฏุง ูโฺฉูุฏ
#     (ูุฎุช ูุฒุงู ุงุฎุชูุงู ูพุชุงูุณู ุจุดุชุฑ ูโุดูุฏ).
#     <br/>
#     4- ุจุง ฺฉุงูุด ููุฏุงุฑ ุงุฎุชูุงู $U_{spike-threshold}$ ู $U_{rest}$ุ ุดุงูุฏ ูุฑฺฉุงูุณ ุจุดุชุฑ ุฏุฑ spikeูุง ุฎูุงูู ุจูุฏ.
# </div>

# In[2]:


from cnsproject.network.neural_populations import LIFPopulation
from cnsproject.network.monitors import Monitor
from cnsproject.plotting.plotting import Plotter
from cnsproject.utils import *
import matplotlib.pyplot as plt
import torch


# <div dir='rtl'>
# <br/>
# ุจุฌุฒ ุงุจุฒุงุฑ ุดุจูโุณุงุฒ (ฺฉู import ุดุฏูโุงูุฏ)ุ ุชุงุจุน ูพุงู ุฏุฑ ุงู ุชูุฑู ุฎุงุตุ ุจุฑุง ุดุจูโุณุงุฒ ู ููุงุณู ููุฑููโูุง ุฏุฑ ฺฉูุงุฑ ูู ุจู ูุง ฺฉูฺฉ ุฎูุงูุฏ ฺฉุฑุฏ. ููฺูู ุฏุฑ ุงู ุชูุฑูุ ูุฑ ุดุจูโุณุงุฒ ุฑุง ุจู ูุฏุช 250ms ุงุฏุงูู ุฎูุงูู ุฏุงุฏ.
# </div>

# In[3]:


def neuron_behaviour(neuron_cls, I, p, time=250, postfix='', name='', **args):
    neuron = neuron_cls((1,), **args)
    monitor = Monitor(neuron, state_variables=["s", "u"], time=time)
    neuron.refractory_and_reset()
    monitor.simulate(neuron.forward, {'I': I})
    p.monitor = monitor
    p.neuron_spike('s'+postfix, x_vis=False, y_label='spikes', title=name)
    p.neuron_voltage('u'+postfix, x_vis=False, y_label="u (mV)", x_label='')
    p.current_dynamic('i'+postfix, I=I, y_label="I (mA)", repeat_till=time)
    
time=250 #ms


# <a id='2'></a>
# <div dir='rtl'>
#     <h2>2. ูุฑูุฏ ุฌุฑุงู ุชุตุงุฏู</h2>
#     <br/>
#     ุจุฑุง ุจุฑุฑุณ ุฏุฑุณุช ฺฉุงุฑฺฉุฑุฏ ูุฏูุ ุฏุฑ ุงุจุชุฏุง ุฑูุชุงุฑ ุงู ูุฏู ุฏุฑ ููุงุจู ูุฑูุฏโูุง ุชุตุงุฏู ุฑุง ููุฑุฏ ุจุฑุฑุณ ูุฑุงุฑ ูโุฏูู.
#     </div>

# <a id='2A'></a>
# <div dir='rtl'>
# <h3>2.A. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุฏุงูููโูุง ูุชูุงูุช ุฌุฑุงู ูุฑูุฏ</h3>
# <br/>
# ุณู ููุน ุฌุฑุงู ูุฑูุฏ ุชุตุงุฏู ุจุง ุฏุงูููโูุง ูุชูุงูุช (ตุ ฑฐ ู ฑต ููโุขููพุฑ) ุชููุฏ ฺฉุฑุฏู ู ุฑูุชุงุฑ ูุฏู ุฏุฑ ุจุฑุงุจุฑ ุงู ุณู ูุฑูุฏ
# ุฑุง ุฏุฑ ฺฉูุงุฑ ูู ุฑุณู ูโฺฉูู. ุงูุชุธุงุฑ ุฏุงุฑู ุจุง ูุฑูุฏ ุดุฏุฏโุชุฑ (ุฏุงููู ุจุฒุฑฺฏโุชุฑ)ุ ูุฏู ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุจุดุชุฑ ุฏุงุดุชู ุจุงุดุฏ (ุงูุชุธุงุฑ ุดูุงุฑู ฑ ุฏุฑ ูุณุช ุงุจุชุฏุง ฺฏุฒุงุฑุด).
# </div>

# In[4]:


plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = torch.rand(time,1)*5
neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=10., name="max I=5mA")

I = torch.rand(time,1)*10
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="max I=10mA")

I = torch.rand(time,1)*15
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=10., name="max I=15mA")

p.show()


# <div dir='rtl'>
# <br/>
#     ูุทุงุจู ุจูุฏ ุงูู ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ
#    ุจุง ุฌุฑุงูโูุง ูุฑูุฏ ุดุฏุฏโุชุฑุ ุดุงูุฏ ูุฑฺฉุงูุณ ุจุดุชุฑ ุฏุฑ spikeูุง ุฎุฑูุฌ ูุณุชู. ุฌุงูุจ ุงุฒ ฺฉู ุจุง ุฌุฑุงู ูุฑูุฏ ุจุง ุฏุงููู 5mVุ ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ูฺโฺฏุงู ุจู ูุฑุฒ spike ููโุฑุณุฏ!
# </div>

# <a id='2B'></a>
# <div dir='rtl'>
# <h3>2.B. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ููุงูุชโูุง ูุชูุงูุช</h3>
# <br/>
#     ุญุงู ุงุฒ ุฌุฑุงู ุชุตุงุฏู ุจุง ุฏุงููู ฑฐููโููุช ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุชุฃุซุฑ ุชุบุฑ ููุงูุช ูุฏู ููุฑูู ุฑุง ููุฑุฏ ุจุฑุฑุณ ูุฑุงุฑ ุฏูู.
# </div>

# In[5]:


plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = torch.rand(time,1)*10

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=1., tau=10., name="R=1ohm")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="R=3ohm")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=5., tau=10., name="R=5ohm")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ฒ ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ ุดุงูุฏ ุงูุฒุงุด ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุจุง ุงูุฒุงุด ููุงูุช ููุฑูู ูุณุชู.
# </div>

# <a id='2C'></a>
# <div dir='rtl'>
# <h3>2.C. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุซุงุจุช ุฒูุงู($\tau$)โูุง ูุชูุงูุช</h3>
# <br/>
#     ุญุงู ุงุฒ ุฌุฑุงู ุชุตุงุฏู ุจุง ุฏุงููู ฑฐููโููุช ู ููุงููุช ณุงูู ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุชุฃุซุฑ ุชุบุฑ ุซุงุจุชโุฒูุงู ูุฏู ููุฑูู ุฑุง ููุฑุฏ ุจุฑุฑุณ ูุฑุงุฑ ุฏูู.
# </div>

# In[6]:


plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = torch.rand(time,1)*10

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=2., name="tau=2ms")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="tau=10ms")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=50., name="tau=50ms")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ณ ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ ุดุงูุฏ ฺฉุงูุด ุณุฑุนุช ุชุบุฑุงุช ุงุฎุชูุงู ูพุชุงูุณู ู ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุฏุฑ ุงุซุฑ ุงูุฒุงุด ููุฏุงุฑ ุซุงุจุช ุฒูุงู ูุฏู ููุฑูู ูุณุชู.
# </div>

# <a id='2D'></a>
# <div dir='rtl'>
# <h3>2.D. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ๐๐๐๐๐โ๐กโ๐๐๐โ๐๐๐ูุง ูุชูุงูุช</h3>
# <br/>
#     ุญุงู ุงุฒ ุฌุฑุงู ุชุตุงุฏู ุจุง ุฏุงููู ฑฐููโููุชุ ููุงููุช ณุงูู ู ุซุงุจุช ุฒูุงู ฑฐููโุซุงูู ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุชุฃุซุฑ ุชุบุฑ ๐๐๐๐๐โ๐กโ๐๐๐โ๐๐๐ ูุฏู ููุฑูู ุฑุง ููุฑุฏ ุจุฑุฑุณ ูุฑุงุฑ ุฏูู.
# </div>

# In[7]:


plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = torch.rand(time,1)*10

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=10., spike_threshold=-65, name="Spike Threshold: -65mV")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., spike_threshold=-55, name="Spike Threshold: -55mV")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=10., spike_threshold=-30, name="Spike Threshold: -30mV")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ด ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏู ููุฑููุ ุจุง ุงูุฒุงุด ุงุฎุชูุงู ุจู spike-threshold ู resting-potentialุ ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ฺฉุงูุด ูพุฏุง ูโฺฉูุฏ (ฺูู ุฑุณุฏู ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุจู ูุฑุฒ spike ุฏุดูุงุฑโุชุฑ ูโุดูุฏ.</div>

# <a id='3'></a>
# <div dir='rtl'>
#     <h2>3. ูุฑูุฏ ุฌุฑุงู ุซุงุจุช</h2>
#     <br/>
#     ูพุดุชุฑ ุดุงูุฏ ูุทุงุจูุช ูุดุงูุฏุงุช ุญุงุตู ุงุฒ ุดุจูโุณุงุฒ ุจุง ุงูุชุธุงุฑุงุช ุฎูุฏ ุงุฒ ูุฏู ุจูุฏู. ุญุงู ุจู ุจุฑุฑุณ ุขุฒูุงุดโูุง ฺฉุณุงู ุงูุง ุงู ุจุงุฑ ุจุง ูุฑูุฏ ุฌุฑุงู ุซุงุจุช ุฎูุงูู ูพุฑุฏุงุฎุช. ุฑูุชุงุฑ ููุฑูู ุฏุฑ ุจุฑุงุจุฑ ุฌุฑุงู ุซุงุจุชุ ููุธูโุชุฑ ุฎูุงูุฏ ุจูุฏ.
#     </div>

# <a id='3A'></a>
# <div dir='rtl'>
# <h3>3.A. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุฏุงูููโูุง ูุชูุงูุช ุฌุฑุงู ูุฑูุฏ</h3>
# <br/>
# </div>

# In[8]:


plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

Ion = 4
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)
neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=10., name="I=4mA")

Ion = 5.5
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="I=5.5mA")

Ion = 8
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=10., name="I=8mA")

p.show()


# <div dir='rtl'>
# <br/>
#     ูุทุงุจู ุจูุฏ ุงูู ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ
#    ุจุง ุฌุฑุงูโูุง ูุฑูุฏ ุดุฏุฏโุชุฑุ ุดุงูุฏ ูุฑฺฉุงูุณ ุจุดุชุฑ ุฏุฑ spikeูุง ุฎุฑูุฌ ูุณุชู. ุฌุงูุจ ุงุฒ ฺฉู ุจุง ุฌุฑุงู ูุฑูุฏ ุจุง ุฏุงููู 4mVุ ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ูฺโฺฏุงู ุจู ูุฑุฒ spike ููโุฑุณุฏ!
# </div>

# <a id='3B'></a>
# <div dir='rtl'>
# <h3>3.B. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ููุงูุชโูุง ูุชูุงูุช</h3>
# <br/>
# </div>

# In[9]:


Ion = 10
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=1., tau=10., name="R=1ohm")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="R=3ohm")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=5., tau=10., name="R=5ohm")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ฒ ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ ุดุงูุฏ ุงูุฒุงุด ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุจุง ุงูุฒุงุด ููุงูุช ููุฑูู ูุณุชู.
# </div>

# <a id='3C'></a>
# <div dir='rtl'>
# <h3>3.C. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ุซุงุจุช ุฒูุงู($\tau$)โูุง ูุชูุงูุช</h3>
# <br/>
# </div>

# In[10]:


Ion = 10
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=2., name="tau=2ms")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="tau=10ms")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=50., name="tau=50ms")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ณ ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏูุ ุดุงูุฏ ฺฉุงูุด ุณุฑุนุช ุชุบุฑุงุช ุงุฎุชูุงู ูพุชุงูุณู ู ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุฏุฑ ุงุซุฑ ุงูุฒุงุด ููุฏุงุฑ ุซุงุจุช ุฒูุงู ูุฏู ููุฑูู ูุณุชู.
# </div>

# <a id='3D'></a>
# <div dir='rtl'>
# <h3>3.D. ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ุจุง ๐๐๐๐๐โ๐กโ๐๐๐โ๐๐๐ูุง ูุชูุงูุช</h3>
# <br/>
# </div>

# In[11]:


Ion = 10
I = step_function(time, 10, val1=Ion) - step_function(time, 215, val1=Ion)

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=50., spike_threshold=-65, name="Spike Threshold: -65mV")
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=50., spike_threshold=-55, name="Spike Threshold: -55mV")
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=50., spike_threshold=-30, name="Spike Threshold: -30mV")

p.show()


# <div dir='rtl'>
# <br/>
# ูุทุงุจู ุจูุฏ ด ุงุฒ ุงูุชุธุงุฑุงุช ูุง ุงุฒ ูุฏู ููุฑููุ ุจุง ุงูุฒุงุด ุงุฎุชูุงู ุจู spike-threshold ู resting-potentialุ ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ฺฉุงูุด ูพุฏุง ูโฺฉูุฏ (ฺูู ุฑุณุฏู ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุจู ูุฑุฒ spike ุฏุดูุงุฑโุชุฑ ูโุดูุฏ.</div>

# <a id='4'></a>
# <div dir='rtl'>
#     <h2>4. ูุฑูุฏ ุฌุฑุงูโูุง ุฏฺฏุฑ</h2>
#     <br/>
#     ุฏุฑ ุงู ุจุฎุดุ ุงุฒ ุณุฑ ฺฉูุฌฺฉุงู ุจู ุจุฑุฑุณ ุฑูุชุงุฑ ูุฏู ููุฑูู ุฏุฑ ุจุฑุงุจุฑ  ฺูุฏ ููุน ุฎุงุต ุงุฒ ุฌุฑุงูโูุง ูุฑูุฏ ู ูุฌููุนู ูพุงุฑุงูุชุฑโูุง ูุชูุงูุช ุฎูุงูู ูพุฑุฏุงุฎุช. 
#     </div>

# <a id='4A'></a>
# <div dir='rtl'>
# <h3>4.A. ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ูุชูุงุฒู</h3>
# <br/>
#     ุฏุฑ ุงู ุจุฎุดุ ุฌุฑุงูโูุง ูุฑูุฏ ุจู ุดฺฉู ูพุงูุณ ูุฑุจุน ุจุง ุฏูุฑูโุชูุงูุจโูุง ูุชูุงูุช ุฑุง ุจุฑุฑุณ ุฎูุงูู ฺฉุฑุฏ.
# </div>

# In[12]:


Ion = 10

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = [0]*3+[Ion]*3
neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=10., name="I-PRI: 6ms")

I = [0]*10+[Ion]*10
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="I-PRI: 20ms")

I = [0]*30+[Ion]*30
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=10., name="I-PRI: 60ms")

p.show()


# <div dir='rtl'>
# <br/>
# ูุชุฌู ูุทุงุจู ุงูุชุธุงุฑ ุงุณุช. ูุฑฺู ุฏูุฑู ุชูุงูุจ ุจุฒุฑฺฏโุชุฑ ุฏุงุดุชู ุจุงุดูุ ุจู ููุฑูู ูููุช ฺฉูุชุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ spike ุฏุงุฏู ูโุดูุฏ. ููฺูู ุฏุฑ ููุงุทุน ฺฉู ูพุงูุณ ุฎุงููุด ุงุณุชุ ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุจู ุญุงูุช rest ูุฒุฏฺฉ ูโุดูุฏ.</div>

# <a id='4B'></a>
# <div dir='rtl'>
# <h3>4.B. ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ูุชูุงุฒู ุจุง ุซุงุจุช ุฒูุงู ูุฏู ููุฑูู ุจุฒุฑฺฏ</h3>
# <br/>
# ุจุง ุชูุฌู ุจู ุชุงุซุฑ ุซุงุจุช ุฒูุงู ูุฏู ููุฑูู ู ุฑูุชุงุฑ ูุฏู ุฏุฑ ุจุฑุงุจุฑ ุฌุฑุงู ูพุงูุณ ูุฑุจุนุ ุงูุชุธุงุฑ ูโุฑูุฏ ุจุง ุญูุธ ุงู ุฌุฑุงู ูุฑูุฏ ู ุงูุฒุงุด ุซุงุจุช ุฒูุงู ูุฏูุ ูุงูุน ุฑุณุฏู ุงุฎุชูุงู ูพุชุงูุณู ููุฑูู ุจู ูุฑุฒ spike ุดูู ู ุฏุฑ ุฒูุงู ุฎุงููุด ูพุงูุณ ูุฑูุฏุ ูุฏู ุจุชูุงูุฏ ุงุฎุชูุงู ูพุชุงูุณู ุฎูุฏ ุฑุง ุชุฎูู ฺฉูุฏ ู ุจู ุงู ุชุฑุชุจุ ูุฑฺฉุงูุณ spike ุฎุฑูุฌ ุจุดุฏุช ฺฉุงูุด ูพุฏุง ฺฉูุฏ.
# </div>

# In[13]:


Ion = 10

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = [0]*3+[Ion]*3
neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=50., name="I-PRI: 6ms")

I = [0]*10+[Ion]*10
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=50., name="I-PRI: 20ms")

I = [0]*30+[Ion]*30
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=50., name="I-PRI: 60ms")

p.show()


# <div dir='rtl'>
# <br/>
# ูุชุฌู ูุทุงุจู ุงูุชุธุงุฑ ุงุณุช.</div>

# <a id='4C'></a>
# <div dir='rtl'>
# <h3>4.C. ูุฑูุฏ ุฌุฑุงู ูพุงูุณ ูุฑุจุน ุบุฑ ูุชูุงุฒู</h3>
# <br/>
# ุงูุชุธุงุฑ ุฏุงุฑู ุจุง ุงูุฒุงุด ูุณุจุช ูุฏุช ุฒูุงู ุฎุงููุด ูพุงูุณ ูุฑูุฏ ู ุจู ูุฏุช ุฒูุงู ุฑูุดู ุจูุฏู ุงู ูพุงูุณุ ูุฏู ูุฑุตุช ุจุดุชุฑ ุจุฑุง ุชุฎูู ูพุชุงูุณู ูพุฏุง ฺฉูุฏ ู ุจุฏูโุชุฑุชุจุ ูุฑฺฉุงูุณ spike ุฑุง ฺฉุงูุด ุฏูุฏ.
# </div>

# In[14]:


Ion = 10

plt.figure(figsize=(14,7))
p = Plotter([
    ['s1','s2','s3'],
    ['u1','u2','u3'],
    ['u1','u2','u3'],
    ['i1','i2','i3'],
    ['i1','i2','i3'],
], wspace=0.3)

I = [0]*30+[Ion]*1
neuron_behaviour(LIFPopulation, I, p, postfix='1', dt=1., R=3., tau=10., name="I: Pulse-On=1ms, Pulse-Off=30ms")

I = [0]*7+[Ion]*3
neuron_behaviour(LIFPopulation, I, p, postfix='2', dt=1., R=3., tau=10., name="I: Pulse-On=3ms, Pulse-Off=7ms")

I = [0]*3+[Ion]*17
neuron_behaviour(LIFPopulation, I, p, postfix='3', dt=1., R=3., tau=10., name="I: Pulse-On=17ms, Pulse-Off=3ms")

p.show()


# <div dir='rtl'>
# <br/>
# ูุชุฌู ูุทุงุจู ุงูุชุธุงุฑ ุงุณุช.</div>

# <a id='5'></a>
# <div dir='rtl'>
#     <h2>5. F-I Curve</h2>
#     <br/>
#     ุฏุฑ ุงู ุจุฎุดุ ุฑูุชุงุฑ ููุฑูู ุฑุง ุฏุฑ ุจุฑุงุจุฑ ูุฒุงู ุดุฏุช ุฌุฑุงู ูุฑูุฏ (ุซุงุจุช)ุ ุจุง ุงุณุชูุงุฏู ุงุฒ ูููุฏุงุฑ F-I ูุดุงูุฏู ูโฺฉูู.
#     </div>

# In[15]:


I_range = 20
def cal_FI(neuron, I_range=I_range):
    monitor = Monitor(neuron, state_variables=["s", "u"], time=time)
    f = []
    for i in range(I_range):
        neuron.refractory_and_reset()
        I = torch.ones(time,1)*i
        monitor.simulate(neuron.forward, {'I': I})
        f.append(sum(monitor['s'])/time)
    return f

plt.figure(figsize=(14,8))
p = Plotter([
    [None,'F','F','F','F',None],
    ['R','R','T','T','S','S'],
], hspace=0.3)
colors = ['blue','green','yellow']

neuron = LIFPopulation((1,), dt=1., R=3., tau=10.)
p.plot('F', y='F', x='I', data={'F':cal_FI(neuron,2*I_range), 'I':list(range(2*I_range))}, label="R=3ohm, tau=10ms, ST=-55mV",
       color='red', y_label="spike frequency (kHz)", x_label="I (mA)", title="F-I curve")
p['F'].legend()

for i,R in enumerate([1,3,5]):
    neuron = LIFPopulation((1,), dt=1., R=R, tau=10.)
    p.plot('R', y='F', x='I', data={'F':cal_FI(neuron), 'I':list(range(I_range))},
           label=f"R={R}mA", color=colors[i], y_label="spike frequency (kHz)")
p['R'].legend()

for i,tau in enumerate([2,10,50]):
    neuron = LIFPopulation((1,), dt=1., R=3., tau=tau)
    p.plot('T', y='F', x='I', data={'F':cal_FI(neuron), 'I':list(range(I_range))},
           label=f"tau={tau}ms", color=colors[i], x_label="I (mA)", title="F-I curve", y_vis=False)
p['T'].legend()

for i,st in enumerate([-65,-55,-30]):
    neuron = LIFPopulation((1,), dt=1., R=3., tau=50., spike_threshold=st)
    p.plot('S', y='F', x='I', data={'F':cal_FI(neuron), 'I':list(range(I_range))},
           label=f"ST={st}mV", color=colors[i], y_vis=False)
p['S'].legend()

p.show()

